{% extends 'base.html' %}
{% block title %}Emparejamientos · Gestor Documental{% endblock %}
{% block content %}
    <h2>🔎 Filtros de emparejamiento</h2>
    <form method="get">
        <input type="text" name="carrera" placeholder="Filtrar por carrera" value="{{ carrera or '' }}">
        <input type="text" name="vacante" placeholder="Filtrar por vacante" value="{{ vacante or '' }}">
        <input type="number" name="minimo" placeholder="Score mínimo" value="{{ minimo or 0 }}" step="1" min="0" max="100">
        <button type="submit">Aplicar filtros</button>
    </form>

    <h2>🔗 Emparejamientos por Candidato</h2>
    <div class="container">
    {% for r in resultados_candidatos %}
        <div style="margin-bottom:30px;">
            <h3>👤 {{ r.candidato }} <span style="font-weight:normal;">({{ r.carrera }})</span></h3>
            {% if r.compatibles %}
                <ul>
                {% for c in r.compatibles %}
                    {% if c.score >= minimo %}
                    <li style="margin-bottom:10px;">
                        ✅ <strong>{{ c.empresa }}</strong> — {{ c.vacante }}
                        <span style="color:#27ae60;">({{ c.score }}%)</span>
                        <ul>
                            {% for razon in c.razones %}
                                <li>🔹 {{ razon }}</li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endif %}
                {% endfor %}
                </ul>
            {% else %}
                <p class="empty">Sin empresas compatibles.</p>
            {% endif %}
        </div>
    {% endfor %}
    </div>

    <h2>🔗 Emparejamientos por Empresa</h2>
    <div class="container">
    {% for r in resultados_empresas %}
        <div style="margin-bottom:30px;">
            <h3>🏢 {{ r.candidato }} <span style="font-weight:normal;">({{ r.vacante }})</span></h3>
            {% if r.compatibles %}
                <ul>
                {% for c in r.compatibles %}
                    {% if c.score >= minimo %}
                    <li style="margin-bottom:10px;">
                        ✅ <strong>{{ c.empresa }}</strong>
                        <span style="color:#27ae60;">({{ c.score }}%)</span>
                        <ul>
                            {% for razon in c.razones %}
                                <li>🔹 {{ razon }}</li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endif %}
                {% endfor %}
                </ul>
            {% else %}
                <p class="empty">Sin candidatos compatibles.</p>
            {% endif %}
        </div>
    {% endfor %}
    </div>
{% endblock %}
